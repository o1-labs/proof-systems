<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-kimchi/custom_constraints" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Custom Constraints | Mina book</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://o1-labs.github.io/proof-systems/kimchi/custom_constraints"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Custom Constraints | Mina book"><meta data-rh="true" name="description" content="This section explains how to design and add a custom constraint to our"><meta data-rh="true" property="og:description" content="This section explains how to design and add a custom constraint to our"><link data-rh="true" rel="icon" href="/proof-systems/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://o1-labs.github.io/proof-systems/kimchi/custom_constraints"><link data-rh="true" rel="alternate" href="https://o1-labs.github.io/proof-systems/kimchi/custom_constraints" hreflang="en"><link data-rh="true" rel="alternate" href="https://o1-labs.github.io/proof-systems/kimchi/custom_constraints" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Custom Constraints","item":"https://o1-labs.github.io/proof-systems/kimchi/custom_constraints"}]}</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.11/dist/katex.min.css" crossorigin="anonymous"><link rel="stylesheet" href="/proof-systems/assets/css/styles.3e58dbd9.css">
<script src="/proof-systems/assets/js/runtime~main.fb0a9564.js" defer="defer"></script>
<script src="/proof-systems/assets/js/main.baa4debc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||"light"),document.documentElement.setAttribute("data-theme-choice",t||"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/proof-systems/"><b class="navbar__title text--truncate">Mina book</b></a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://o1-labs.github.io/proof-systems/rustdoc/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Rust Docs<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/o1-labs/proof-systems" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/proof-systems/"><span title="Introduction" class="linkLabel_WmDU">Introduction</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/proof-systems/fundamentals/zkbook_foundations"><span title="Foundations" class="categoryLinkLabel_W154">Foundations</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/proof-systems/fundamentals/zkbook_commitment"><span title="Cryptographic Tools" class="categoryLinkLabel_W154">Cryptographic Tools</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/proof-systems/plonk/overview"><span title="Background on PLONK" class="categoryLinkLabel_W154">Background on PLONK</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/proof-systems/kimchi/overview"><span title="Kimchi" class="categoryLinkLabel_W154">Kimchi</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/proof-systems/kimchi/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/proof-systems/kimchi/arguments"><span title="Arguments" class="linkLabel_WmDU">Arguments</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/proof-systems/kimchi/final_check"><span title="Understanding the implementation of the $f(\zeta) = Z_H(\zeta) t(\zeta)$ check" class="linkLabel_WmDU">Understanding the implementation of the $f(\zeta) = Z_H(\zeta) t(\zeta)$ check</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/proof-systems/kimchi/maller_15"><span title="Maller&#x27;s optimization for Kimchi" class="linkLabel_WmDU">Maller&#x27;s optimization for Kimchi</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/proof-systems/kimchi/lookup"><span title="Lookup Tables" class="categoryLinkLabel_W154">Lookup Tables</span></a><button aria-label="Expand sidebar category &#x27;Lookup Tables&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/proof-systems/kimchi/custom_constraints"><span title="Custom Constraints" class="linkLabel_WmDU">Custom Constraints</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist" tabindex="0" href="/proof-systems/kimchi/gates"><span title="Custom Gates" class="categoryLinkLabel_W154">Custom Gates</span></a><button aria-label="Expand sidebar category &#x27;Custom Gates&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/proof-systems/pickles/overview"><span title="Pickles &amp; Inductive Proof Systems" class="categoryLinkLabel_W154">Pickles &amp; Inductive Proof Systems</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/proof-systems/specs/poseidon"><span title="Technical Specifications" class="categoryLinkLabel_W154">Technical Specifications</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/proof-systems/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Kimchi</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Custom Constraints</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Custom Constraints</h1></header><p>This section explains how to design and add a custom constraint to our
<code>proof-systems</code> library.</p>
<p>PLONK is an AIOP. That is, it is a protocol in which the prover sends
polynomials as messages and the verifier sends random challenges, and then
evaluates the prover&#x27;s polynomials and performs some final checks on the
outputs.</p>
<p>PLONK is very flexible. It can be customized with constraints specific to
computations of interest. For example, in Mina, we use a PLONK configuration
called kimchi that has custom constraints for poseidon hashing, doing elliptic
curve operations, and more.</p>
<p>A &quot;PLONK configuration&quot; specifies</p>
<ul>
<li class="">The set of types of constraints that you would like to be able to enforce. We
will describe below how these types of constraints are specified.</li>
<li class="">A number of &quot;eq-able&quot; columns <code>W</code></li>
<li class="">A number of &quot;advice&quot; columns <code>A</code></li>
</ul>
<p>Under such configuration, a circuit is specified by</p>
<ul>
<li class="">A number of rows <code>n</code></li>
<li class="">A vector <code>cs</code> of constraint-types of length <code>n</code>. I.e., a vector that
specifies, for each row, which types of constraints should be enforced on that
row.</li>
<li class="">A vector <code>eqs : Vec&lt;(Position, Position)&gt;</code> of equalities to enforce, where
<code>struct Position { row: usize, column: usize }</code>. E.g., if the pair
<code>(Position { row: 0, col: 8 }, Position { row: 10, col: 2 })</code> is in <code>eqs</code>,
then the circuit is saying the entries in those two positions should be equal,
or in other words that they refer to the same value. This is where the
distinction between &quot;eq-able&quot; and &quot;advice&quot; columns comes in. The <code>column</code>
field of a position in the <code>eqs</code> array can only refer to one of the first <code>W</code>
columns. Equalities cannot be enforced on entries in the <code>A</code> columns after
that.</li>
</ul>
<p>Then, given such a circuit, PLONK lets you produce proofs for the statement</p>
<blockquote>
<p>I know <code>W + A</code> &quot;column vectors&quot; of field elements <code>vs: [Vec&lt;F&gt;; W + A]</code> such
that for each row index <code>i &lt; n</code>, the constraint of type <code>cs[i]</code> holds on the
values <code>[vs[0][i], ..., vs[W+A - 1][i], vs[0][i+1], ..., vs[W+A - 1][i+1]</code> and
all the equalities in <code>eqs</code> hold. I.e., for <code>(p1, p2)</code> in <code>eqs</code> we have
<code>vs[p1.col][p1.row] == vs[p2.col][p2.row]</code>. So, a constraint can check the
values in two adjacent rows.</p>
</blockquote>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="specifying-a-constraint">Specifying a constraint<a href="#specifying-a-constraint" class="hash-link" aria-label="Direct link to Specifying a constraint" title="Direct link to Specifying a constraint" translate="no">​</a></h2>
<p>Mathematically speaking, a constraint is a multivariate polynomial over the
variables
<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>c</mi><mrow><mrow><mi mathvariant="sans-serif">C</mi><mi mathvariant="sans-serif">u</mi><mi mathvariant="sans-serif">r</mi><mi mathvariant="sans-serif">r</mi></mrow><mo separator="true">,</mo><mi>i</mi></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>v</mi><mrow><mrow><mi mathvariant="sans-serif">C</mi><mi mathvariant="sans-serif">u</mi><mi mathvariant="sans-serif">r</mi><mi mathvariant="sans-serif">r</mi></mrow><mo separator="true">,</mo><mi>W</mi><mo>+</mo><mi>A</mi><mo>−</mo><mn>1</mn></mrow></msub><mo separator="true">,</mo><msub><mi>v</mi><mrow><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">e</mi><mi mathvariant="sans-serif">x</mi><mi mathvariant="sans-serif">t</mi></mrow><mo separator="true">,</mo><mn>0</mn></mrow></msub><mo separator="true">,</mo><mo>…</mo><mo separator="true">,</mo><msub><mi>v</mi><mrow><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">e</mi><mi mathvariant="sans-serif">x</mi><mi mathvariant="sans-serif">t</mi></mrow><mo separator="true">,</mo><mi>W</mi><mo>+</mo><mi>A</mi><mo>−</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">c_{\mathsf{Curr},i}, \dots, v_{\mathsf{Curr}, W+A-1}, v_{\mathsf{Next}, 0}, \dots, v_{\mathsf{Next}, W+A-1}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal">c</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:0em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathsf mtight" style="margin-right:0.01389em">Curr</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathsf mtight" style="margin-right:0.01389em">Curr</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.13889em">W</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">A</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathsf mtight">Next</span></span><span class="mpunct mtight">,</span><span class="mord mtight">0</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="minner">…</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mpunct">,</span><span class="mspace" style="margin-right:0.1667em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathsf mtight">Next</span></span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight" style="margin-right:0.13889em">W</span><span class="mbin mtight">+</span><span class="mord mathnormal mtight">A</span><span class="mbin mtight">−</span><span class="mord mtight">1</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span>.
In other words, there is one variable corresponding to the value of each column
in the &quot;current row&quot; and one variable correspond to the value of each column in
the &quot;next row&quot;.</p>
<p>In Rust, <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mrow><mi>r</mi><mo separator="true">,</mo><mi>i</mi></mrow></msub></mrow><annotation encoding="application/x-tex">v_{r, i}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3117em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mathnormal mtight" style="margin-right:0.02778em">r</span><span class="mpunct mtight">,</span><span class="mord mathnormal mtight">i</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> is written <code>E::cell(Column::Witness(i), r)</code>. So, for
example, the variable <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mrow><mrow><mi mathvariant="sans-serif">N</mi><mi mathvariant="sans-serif">e</mi><mi mathvariant="sans-serif">x</mi><mi mathvariant="sans-serif">t</mi></mrow><mo separator="true">,</mo><mn>3</mn></mrow></msub></mrow><annotation encoding="application/x-tex">v_{\mathsf{Next}, 3}</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.7167em;vertical-align:-0.2861em"></span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em">v</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.3361em"><span style="top:-2.55em;margin-left:-0.0359em;margin-right:0.05em"><span class="pstrut" style="height:2.7em"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight"><span class="mord mtight"><span class="mord mathsf mtight">Next</span></span><span class="mpunct mtight">,</span><span class="mord mtight">3</span></span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.2861em"><span></span></span></span></span></span></span></span></span></span> is written
<code>E::cell(Column::Witness(3), CurrOrNext::Next)</code>.</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">let w = |i| v(Column::Witness(i));</span><br></span></code></pre></div></div>
<p>Let&#x27;s</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="defining-a-plonk-configuration">Defining a PLONK configuration<a href="#defining-a-plonk-configuration" class="hash-link" aria-label="Direct link to Defining a PLONK configuration" title="Direct link to Defining a PLONK configuration" translate="no">​</a></h2>
<p>The art in proof systems comes from knowing how to design a PLONK configuration
to ensure maximal efficiency for the sorts of computations you are trying to
prove. That is, how to choose the numbers of columns <code>W</code> and <code>A</code>, and how to
define the set of constraint types.</p>
<p>Let&#x27;s describe the trade-offs involved here.</p>
<p>The majority of the proving time for the PLONK prover is in</p>
<ul>
<li class="">committing to the <code>W + A</code> column polynomials, which have length equal to the
number of rows <code>n</code></li>
<li class="">committing to the &quot;permutation accumulator polynomial, which has length <code>n</code>.</li>
<li class="">committing to the quotient polynomial, which reduces to computing <code>max(k, W)</code>
MSMs of size <code>n</code>, where <code>k</code> is the max degree of a constraint.</li>
<li class="">performing the commitment opening proof, which is mostly dependent on the
number of rows <code>n</code>.</li>
</ul>
<p>So all in all, the proving time is approximately equal to the time to perform
<code>W + A + 1 + max(k - 1, W)</code> MSMs of size <code>n</code>, plus the cost of an opening proof
for polynomials of degree <code>n - 1</code>.</p>
<p>and maybe</p>
<ul>
<li class="">
<p>computing the combined constraint polynomial, which has degree <code>k * n</code> where
<code>k</code> is the maximum degree of a constraint</p>
</li>
<li class="">
<p>Increasing <code>W</code> and <code>A</code> increase proof size, and they potentially impact the
prover-time as the prover must compute polynomial commitments to each column,
and computing a polynomial commitment corresponds to doing one MSM
(multi-scalar multiplication, also called a multi-exponentiation.)</p>
<p>However, often increasing the number of columns allows you to decrease the
number of rows required for a given computation. For example, if you can
perform one Poseidon hash in 36 rows with 5 total columns, then you can also
perform it in 12 (= 36 / 3) rows with 15 (= 5 * 3) total columns.</p>
<p><strong>Decreasing the number of rows (even while keeping the total number of table
entries the same) is desirable because it reduces the cost of the polynomial
commitment opening proof, which is dominated by a factor linear in the number
of rows, and barely depends on the number of columns.</strong></p>
<p>Increasing the number of columns also increases verifier time, as the verifier
must perform one scalar-multiplication and one hash per column. Proof length
is also affected by a larger number of columns, as more polynomials need to be
committed and sent along to the verifier.</p>
</li>
</ul>
<p>There is typically some interplay between these</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/o1-labs/proof-systems/tree/master/book/docs/kimchi/custom_constraints.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/proof-systems/kimchi/extended-lookup-tables"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Extended lookup tables</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/proof-systems/kimchi/gates"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">gates</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#specifying-a-constraint" class="table-of-contents__link toc-highlight">Specifying a constraint</a></li><li><a href="#defining-a-plonk-configuration" class="table-of-contents__link toc-highlight">Defining a PLONK configuration</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/proof-systems/">Introduction</a></li><li class="footer__item"><a href="https://o1-labs.github.io/proof-systems/rustdoc/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Rust Documentation<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://minaprotocol.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Mina Protocol<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://discord.gg/minaprotocol" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/o1-labs/proof-systems" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2026 o1Labs. Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>