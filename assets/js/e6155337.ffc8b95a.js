"use strict";(globalThis.webpackChunkmina_book=globalThis.webpackChunkmina_book||[]).push([[4958],{1165(e,s,i){i.d(s,{A:()=>a});const a=i.p+"assets/images/pickles_structure_overview-74aa25eb3243c51c07e902c103a047f9.svg"},7484(e,s,i){i.r(s),i.d(s,{assets:()=>l,contentTitle:()=>c,default:()=>m,frontMatter:()=>r,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"pickles/overview","title":"Overview of Pickles","description":"Pickles is a recursion layer built on top of Kimchi. The complexity of pickles","source":"@site/docs/pickles/overview.md","sourceDirName":"pickles","slug":"/pickles/overview","permalink":"/proof-systems/pickles/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/o1-labs/proof-systems/tree/master/book/docs/pickles/overview.md","tags":[],"version":"current","frontMatter":{},"sidebar":"docsSidebar","previous":{"title":"Keccak Gate","permalink":"/proof-systems/kimchi/keccak"},"next":{"title":"Inductive proof systems","permalink":"/proof-systems/pickles/zkbook_ips"}}');var t=i(4848),n=i(8453);const r={},c="Overview of Pickles",l={},o=[{value:"General Circuit Structure",id:"general-circuit-structure",level:4},{value:"On Accumulators",id:"on-accumulators",level:4}];function h(e){const s={a:"a",annotation:"annotation",code:"code",h1:"h1",h4:"h4",header:"header",img:"img",li:"li",math:"math",mi:"mi",mn:"mn",mo:"mo",mrow:"mrow",msub:"msub",ol:"ol",p:"p",semantics:"semantics",span:"span",strong:"strong",ul:"ul",...(0,n.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.header,{children:(0,t.jsx)(s.h1,{id:"overview-of-pickles",children:"Overview of Pickles"})}),"\n",(0,t.jsx)(s.p,{children:'Pickles is a recursion layer built on top of Kimchi. The complexity of pickles\nas a protocol lies in specifying how to verify previous kimchi inside of the\ncurrent ones. Working over two curves requires us to have different circuits and\na "mirrored" structure, some computations are deferred for efficiency, and one\nneeds to carefully keep track of the accumulators. In this section we provide a\ngeneral overview of pickles, while next sections in the same chapter dive into\nthe actual implementation details.'}),"\n",(0,t.jsxs)(s.p,{children:["Pickles works over ",(0,t.jsx)(s.a,{href:"/proof-systems/specs/pasta",children:"Pasta"}),", a cycle of curves consisting of\nPallas and Vesta, and thus it defines two generic circuits, one for each curve.\nEach can be thought of as a parallel instantiation of a kimchi proof systems.\nThese circuits are not symmetric and have somewhat different function:"]}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Step circuit"}),": this is the main circuit that contains application logic.\nEach step circuit verifies a statement and potentially several (at most 2)\nother wrap proofs."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Wrap circuit"}),": this circuit merely verifies the step circuit, and does not\nhave its own application logic. The intuition is that every time an\napplication statement is proven it's done in Step, and then the resulting\nproof is immediately wrapped using Wrap."]}),"\n"]}),"\n",(0,t.jsx)(s.h4,{id:"general-circuit-structure",children:"General Circuit Structure"}),"\n",(0,t.jsx)(s.p,{children:"Both Step and Wrap circuits additionally do a lot of recursive verification of\nthe previous steps. Without getting too technical, Step (without lost of\ngenerality) does the following:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsx)(s.li,{children:"Execute the application logic statement (e.g. the mina transaction is valid)"}),"\n",(0,t.jsx)(s.li,{children:"Verify that the previous Wrap proof is (first-)half-valid (perform only main\nchecks that are efficient for the curve)"}),"\n",(0,t.jsx)(s.li,{children:"Verify that the previous Step proof is (second-)half-valid (perform the\nsecondary checks that were inefficient to perform when the previous Step was\nWrapped)"}),"\n",(0,t.jsxs)(s.li,{children:["Verify that the previous Step correctly aggregated the previous accumulator,\ne.g.\n",(0,t.jsxs)(s.span,{className:"katex",children:[(0,t.jsx)(s.span,{className:"katex-mathml",children:(0,t.jsx)(s.math,{xmlns:"http://www.w3.org/1998/Math/MathML",children:(0,t.jsxs)(s.semantics,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsxs)(s.msub,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"a"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"c"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"c"})]}),(0,t.jsx)(s.mn,{children:"2"})]}),(0,t.jsx)(s.mo,{children:"="}),(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"A"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"g"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"g"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"r"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"e"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"g"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"a"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"t"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"e"})]}),(0,t.jsx)(s.mo,{stretchy:"false",children:"("}),(0,t.jsxs)(s.msub,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"a"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"c"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"c"})]}),(0,t.jsx)(s.mn,{children:"1"})]}),(0,t.jsx)(s.mo,{separator:"true",children:","}),(0,t.jsxs)(s.msub,{children:[(0,t.jsx)(s.mi,{children:"\u03c0"}),(0,t.jsxs)(s.mrow,{children:[(0,t.jsxs)(s.mrow,{children:[(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"s"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"t"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"e"}),(0,t.jsx)(s.mi,{mathvariant:"sans-serif",children:"p"})]}),(0,t.jsx)(s.mo,{separator:"true",children:","}),(0,t.jsx)(s.mn,{children:"2"})]})]}),(0,t.jsx)(s.mo,{stretchy:"false",children:")"})]}),(0,t.jsx)(s.annotation,{encoding:"application/x-tex",children:"\\mathsf{acc}_2 = \\mathsf{Aggregate}(\\mathsf{acc}_1, \\pi_{\\mathsf{step},2})"})]})})}),(0,t.jsxs)(s.span,{className:"katex-html","aria-hidden":"true",children:[(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"0.5944em",verticalAlign:"-0.15em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord",children:(0,t.jsx)(s.span,{className:"mord mathsf",children:"acc"})}),(0,t.jsx)(s.span,{className:"msupsub",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,t.jsxs)(s.span,{style:{top:"-2.55em",marginRight:"0.05em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(s.span,{className:"mord mtight",children:"2"})})]})}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(s.span,{})})})]})})]}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}}),(0,t.jsx)(s.span,{className:"mrel",children:"="}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.2778em"}})]}),(0,t.jsxs)(s.span,{className:"base",children:[(0,t.jsx)(s.span,{className:"strut",style:{height:"1.0361em",verticalAlign:"-0.2861em"}}),(0,t.jsx)(s.span,{className:"mord",children:(0,t.jsx)(s.span,{className:"mord mathsf",children:"Aggregate"})}),(0,t.jsx)(s.span,{className:"mopen",children:"("}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord",children:(0,t.jsx)(s.span,{className:"mord mathsf",children:"acc"})}),(0,t.jsx)(s.span,{className:"msupsub",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,t.jsxs)(s.span,{style:{top:"-2.55em",marginRight:"0.05em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsx)(s.span,{className:"mord mtight",children:"1"})})]})}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.15em"},children:(0,t.jsx)(s.span,{})})})]})})]}),(0,t.jsx)(s.span,{className:"mpunct",children:","}),(0,t.jsx)(s.span,{className:"mspace",style:{marginRight:"0.1667em"}}),(0,t.jsxs)(s.span,{className:"mord",children:[(0,t.jsx)(s.span,{className:"mord mathnormal",style:{marginRight:"0.03588em"},children:"\u03c0"}),(0,t.jsx)(s.span,{className:"msupsub",children:(0,t.jsxs)(s.span,{className:"vlist-t vlist-t2",children:[(0,t.jsxs)(s.span,{className:"vlist-r",children:[(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.3011em"},children:(0,t.jsxs)(s.span,{style:{top:"-2.55em",marginLeft:"-0.0359em",marginRight:"0.05em"},children:[(0,t.jsx)(s.span,{className:"pstrut",style:{height:"2.7em"}}),(0,t.jsx)(s.span,{className:"sizing reset-size6 size3 mtight",children:(0,t.jsxs)(s.span,{className:"mord mtight",children:[(0,t.jsx)(s.span,{className:"mord mtight",children:(0,t.jsx)(s.span,{className:"mord mathsf mtight",children:"step"})}),(0,t.jsx)(s.span,{className:"mpunct mtight",children:","}),(0,t.jsx)(s.span,{className:"mord mtight",children:"2"})]})})]})}),(0,t.jsx)(s.span,{className:"vlist-s",children:"\u200b"})]}),(0,t.jsx)(s.span,{className:"vlist-r",children:(0,t.jsx)(s.span,{className:"vlist",style:{height:"0.2861em"},children:(0,t.jsx)(s.span,{})})})]})})]}),(0,t.jsx)(s.span,{className:"mclose",children:")"})]})]})]}),"."]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The diagram roughly illustrates the interplay of the two kimchi instances."}),"\n",(0,t.jsx)(s.p,{children:(0,t.jsx)(s.img,{alt:"Overview",src:i(1165).A+""})}),"\n",(0,t.jsx)(s.p,{children:"We note that the Step circuit may repeat items 2-3 to handle the following case:\nwhen Step 2 consumes several Wrap 1.X (e.g. Wrap 1.1, Wrap 1.2, etc), it must\nperform all these main Wrap 1.X checks, but also all the deferred Step 1.X\nchecks where Wrap 1.X wraps exactly Step 1.X."}),"\n",(0,t.jsx)(s.h4,{id:"on-accumulators",children:"On Accumulators"}),"\n",(0,t.jsxs)(s.p,{children:["The accumulator is an abstraction introduced for the purpose of this diagram. In\npractice, each kimchi proof consists of (1) commitments to polynomials, (2)\nevaluations of them, (3) and the opening proof. What we refer to as accumulator\nhere is actually the commitment inside the opening proof. It is called ",(0,t.jsx)(s.code,{children:"sg"})," in\nthe implementation and is semantically a polynomial commitment to ",(0,t.jsx)(s.code,{children:"h(X)"}),"\n(",(0,t.jsx)(s.code,{children:"b_poly"})," in the code) --- the poly-sized polynomial that is built from IPA\nchallenges. It's a very important polynomial -- it can be evaluated in log time,\nbut the commitment verification takes poly time, so the fact that ",(0,t.jsx)(s.code,{children:"sg"})," is a\ncommitment to ",(0,t.jsx)(s.code,{children:"h(X)"})," is never proven inside the circuit. For more details, see\n",(0,t.jsx)(s.a,{href:"https://eprint.iacr.org/2020/499.pdf",children:"Proof-Carrying Data from Accumulation Schemes"}),",\nAppendix A.2, where ",(0,t.jsx)(s.code,{children:"sg"})," is called ",(0,t.jsx)(s.code,{children:"U"}),"."]}),"\n",(0,t.jsxs)(s.p,{children:['In pickles, what we do is that we "absorb" this commitment ',(0,t.jsx)(s.code,{children:"sg"})," from the\nprevious step while creating a new proof. That is, for example, Step 1 will\nproduce this commitment that is denoted as ",(0,t.jsx)(s.code,{children:"acc1"}),' on the diagram, as part of its\nopening proof, and Step 2 will absorb this commitment. And this "absorption" is\nwhat Wrap 2 will prove (and, partially, Step 3 will also refer to the challenges\nused to build ',(0,t.jsx)(s.code,{children:"acc1"}),", but this detail is completely avoided in this overview).\nIn the end, ",(0,t.jsx)(s.code,{children:"acc2"})," will be the result of Step 2, so in a way ",(0,t.jsx)(s.code,{children:"acc2"}),' "aggregates"\n',(0,t.jsx)(s.code,{children:"acc1"})," which somewhat justifies the language used."]})]})}function m(e={}){const{wrapper:s}={...(0,n.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},8453(e,s,i){i.d(s,{R:()=>r,x:()=>c});var a=i(6540);const t={},n=a.createContext(t);function r(e){const s=a.useContext(n);return a.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),a.createElement(n.Provider,{value:s},e.children)}}}]);